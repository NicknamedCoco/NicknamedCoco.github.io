<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="NicknamedCoco"><meta name="copyright" content="NicknamedCoco"><meta name="generator" content="Hexo 6.2.0"><meta name="theme" content="hexo-theme-yun"><title>SpringCloud学习之服务注册中心 | CocoBlog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.3.3/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/@unocss/runtime/mini.global.js"></script><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="https://cdn.wanyiai.com/blog/bg/keyi.ico"><link rel="mask-icon" href="https://cdn.wanyiai.com/blog/bg/keyi.ico" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"wanyiai.com","root":"/","title":["Coco","Coding"],"version":"1.10.2","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"local_search":{"path":"/search.xml"},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false,"src":"/js/search/local-search.js"},"fireworks":{"colors":null},"waline":{"config":{"enable":true,"serverURL":"https://waline.wanyiai.com","comment":true,"placeholder":"要文明评论哦, 不然会被打屁屁","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-cn","visitor":false,"comment_count":true,"emoji":["https://fastly.jsdelivr.net/gh/walinejs/emojis@latest/bilibili/","https://fastly.jsdelivr.net/gh/walinejs/emojis@latest/weibo/","https://fastly.jsdelivr.net/gh/walinejs/emojis@latest/qq/"],"locale":{"placeholder":"填写邮箱，可以收到回复通知哦～","requiredFields":["nick"]},"el":"#waline"},"cdn":"https://fastly.jsdelivr.net/npm/@waline/client@v2/dist/waline.js","dark":"html.dark"},"vendors":{"darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="近况  一转眼12天就过去了，又忙实习的事情，又看网课，还有学校方面的事情，看完这部分的网课终于可以着手写一篇博客了，说是博客，我更加觉得我只是在记笔记，记笔记是必要的，不然在学习上不能给我成就感没有成就感，就难有动力继续走下去，但凡能让我有成就感的事情，我都想去完成，这种成就感鼓励我继续写博客记笔记，形成正循环，现在这个博客还不完美，等以后，我可能想去做一个自己的博客，现在实力不够继续好好学习">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringCloud学习之服务注册中心">
<meta property="og:url" content="https://wanyiai.com/2021/10/22/SpringCloud%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/index.html">
<meta property="og:site_name" content="CocoBlog">
<meta property="og:description" content="近况  一转眼12天就过去了，又忙实习的事情，又看网课，还有学校方面的事情，看完这部分的网课终于可以着手写一篇博客了，说是博客，我更加觉得我只是在记笔记，记笔记是必要的，不然在学习上不能给我成就感没有成就感，就难有动力继续走下去，但凡能让我有成就感的事情，我都想去完成，这种成就感鼓励我继续写博客记笔记，形成正循环，现在这个博客还不完美，等以后，我可能想去做一个自己的博客，现在实力不够继续好好学习">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.wanyiai.com/blog/springcloud/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF.png">
<meta property="og:image" content="https://cdn.wanyiai.com/blog/springcloud/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF4.png">
<meta property="og:image" content="https://cdn.wanyiai.com/blog/springcloud/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF3.png">
<meta property="og:image" content="https://cdn.wanyiai.com/blog/springcloud/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF2.png">
<meta property="og:image" content="https://cdn.wanyiai.com/blog/springcloud/Springcloud%E5%8D%87%E7%BA%A7.png">
<meta property="og:image" content="https://cdn.wanyiai.com/blog/springcloud/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E5%9B%BE.png">
<meta property="og:image" content="https://cdn.wanyiai.com/blog/springcloud/%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E5%9B%BE.png">
<meta property="og:image" content="https://cdn.wanyiai.com/blog/springcloud/boot-cloud-alibaba%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.png">
<meta property="og:image" content="https://cdn.wanyiai.com/blog/springcloud/eureka.png">
<meta property="og:image" content="https://cdn.wanyiai.com/blog/springcloud/CAP%E7%90%86%E8%AE%BA.png">
<meta property="og:image" content="https://cdn.wanyiai.com/blog/springcloud/Ribbon%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png">
<meta property="og:image" content="https://cdn.wanyiai.com/blog/springcloud/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95.png">
<meta property="og:image" content="https://cdn.wanyiai.com/blog/springcloud/%E6%9C%8D%E5%8A%A1%E5%88%86%E7%BA%A7%E5%AD%98%E5%82%A81.png">
<meta property="article:published_time" content="2021-10-22T02:34:38.000Z">
<meta property="article:modified_time" content="2022-09-10T06:09:06.017Z">
<meta property="article:author" content="NicknamedCoco">
<meta property="article:tag" content="SpringCloud">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.wanyiai.com/blog/springcloud/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF.png"><script>(function() {
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button sidebar-nav-active" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel sidebar-panel-active" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="NicknamedCoco"><img width="96" loading="lazy" src="https://cdn.wanyiai.com/blog/bg/keyi.jpg" alt="NicknamedCoco"></a><div class="site-author-name"><a href="/about/">NicknamedCoco</a></div><a class="site-name" href="/about/site.html">CocoBlog</a><sub class="site-subtitle">OneForAll</sub><div class="site-description">寻找自己的价值，才是生命的意义</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="我的主页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">119</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">8</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">75</span></a></div><a class="site-state-item hty-icon-button" href="/about/#comment" title="留言板"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-clipboard-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=506579631&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><span class="icon iconify" data-icon="ri:qq-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/NicknamedCoco" title="GitHub" target="_blank" style="color:#1da1f2"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/NicknamedCoco/" title="知乎" target="_blank" style="color:#0084FF"><span class="icon iconify" data-icon="ri:zhihu-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/NicknamedCoco" title="Twitter" target="_blank" style="color:#1da1f2"><span class="icon iconify" data-icon="ri:twitter-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content">此文章未包含目录</div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://wanyiai.com/2021/10/22/SpringCloud%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="NicknamedCoco"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="CocoBlog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">SpringCloud学习之服务注册中心</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2021-10-22 10:34:38" itemprop="dateCreated datePublished" datetime="2021-10-22T10:34:38+08:00">2021-10-22</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="修改时间：2022-09-10 14:09:06" itemprop="dateModified" datetime="2022-09-10T14:09:06+08:00">2022-09-10</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="本文字数">8.4k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="阅读时长">33m</span></span></span><span class="post-meta-divider">-</span><a href="#comment"><span class="post-meta-item-icon" title="评论数"><span class="icon iconify" data-icon="ri:chat-3-line"></span> <span class="waline-comment-count" id="/2021/10/22/SpringCloud%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/"></span></span></a><div class="post-classify"><span class="post-tag"><a class="tag-item" href="/tags/SpringCloud/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">SpringCloud</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><blockquote>
<p>近况</p>
</blockquote>
<p>一转眼12天就过去了，又忙实习的事情，又看网课，还有学校方面的事情，看完这部分的网课终于可以着手<br>写一篇博客了，说是博客，我更加觉得我只是在记笔记，记笔记是必要的，不然在学习上不能给我成就感<br>没有成就感，就难有动力继续走下去，但凡能让我有成就感的事情，我都想去完成，这种成就感鼓励我继续<br>写博客记笔记，形成正循环，现在这个博客还不完美，等以后，我可能想去做一个自己的博客，现在实力不够<br>继续好好学习，OK，咱们废话不多说，先来看看本篇博客主要讲写什么：</p>
<ul>
<li><a href="#a">微服务，服务注册中心的概念和理解</a></li>
<li><a href="#f">项目基本介绍</a></li>
<li><a href="#b">eureka的基本使用</a></li>
<li><a href="#c">ribbon的基本使用</a></li>
<li><a href="#d">consul的基本使用</a></li>
<li><a href="#e">nacos中关于注册中心的使用</a></li>
</ul>
<blockquote>
<p><span id="a">微服务，服务注册中心的概念和理解</span></p>
</blockquote>
<ul>
<li><p>微服务的概念<br>从前我们的后端项目只是单体应用，所有东西写在一个项目中，大不了搞多个实例做负载均衡<br>而微服务指的是将大型单体应用按功能划分，将不同的功能拆分出来，形成许多小的应用，<br>我们可以使用maven中的模块功能来实现上面功能，从而实现一个个模块，例如拆分成：订单模块，用户模块等等。</p>
<p>这一个个模块我们称之为微服务，而被拆分出来的微服务同时也面临着很多问题，自然而然产生了许多解决<br>微服务问题的框架，技术，例如我们的SpringCloud，SpringCloud解决的是这些问题中的服务治理问题<br>由这些解决问题的框架加上我们一个个业务模块，以此形成一整套架构，这被称为分布式架构或者微服务架构</p>
<p>分布式架构的主要特点是高可用，什么是高可用，例如订单模块访问用户模块，如果这些模块只有一台实例<br>那么当用户模块挂了，订单模块岂不是也会被影响到，所以这肯定不是高可用，高可用的前提是集群<br>即一个模块有多个实例，模块也被称为服务，所以可以说订单服务下有多个订单实例，用户服务下有多个用户实例，<br>当某个订单实例访问某个用户实例时，这个用户实例挂了，还有其他用户实例可以访问，不会影响到自己，<br>这就是所谓的高可用，分布式架构需要的就是高可用，可以随时配置服务实例，之后你会看到，分布式架构中，<br>不管什么东西都会是集群配置。最后，或许你会看到分布式架构，微服务架构，在我初学者看来，这两者都是一样的概念。</p>
</li>
<li><p>我们在微服务中需要学习哪些技术<br>如何快速学习一项技术，需要看这个技术是什么，有什么作用，在整体环境下解决什么问题，<br>先从大的角度了解这项技术，再去学习这个技术下的每一个部分，</p>
<p>下面来看看微服务中我们需要学习哪些技术<br>图一：</p>
<p><img src="https://cdn.wanyiai.com/blog/springcloud/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF.png" alt="微服务技术栈" loading="lazy"></p>
<p>图二：  <img src="https://cdn.wanyiai.com/blog/springcloud/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF4.png" alt="微服务技术栈" loading="lazy"><br>图3：<br>  <img src="https://cdn.wanyiai.com/blog/springcloud/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF3.png" alt="微服务技术栈" loading="lazy"><br>接着看下，黑马和尚硅谷微服务课程中教授的框架：<br>黑马：</p>
<p><img src="https://cdn.wanyiai.com/blog/springcloud/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8A%80%E6%9C%AF2.png" alt="微服务技术栈" loading="lazy"><br>  尚硅谷：<br>  <img src="https://cdn.wanyiai.com/blog/springcloud/Springcloud%E5%8D%87%E7%BA%A7.png" alt="微服务技术栈" loading="lazy"><br>  最后来看看，微服务架构整体设计：<br>  <img src="https://cdn.wanyiai.com/blog/springcloud/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt="微服务技术栈" loading="lazy"></p>
</li>
<li><p>服务注册中心<br>黑马尚硅谷的网课我都看，目前学完nacos为止，个人感觉尚硅谷网课非常不错，我们看上面尚硅谷技术图中<br>服务注册中心下需要学习的框架是：eureka，ZooKeeper，consul，nacos，当然在学习这些框架时候<br>我还学习了部分Ribbon的部分知识，本篇博客就围绕简单介绍这几个框架的应用吧，当然在介绍框架之前<br>让我们来了解下，什么是服务注册中心</p>
<p>上面提到SpringCloud是用来解决服务治理问题的，而SpringCloud正是借助eureka模块来实现服务治理的，<br>在传统的RPC远程调用框架中，管理每个服务与服务之间的依赖关系比较复杂，管理非常复杂，所以需要使用<br>服务治理，管理服务与服务之间的依赖关系，可以实现服务调用，负载均衡，容错等，实现服务发现与注册<br>上述的服务就是我们说的模块，即服务=模块</p>
<p><strong>服务注册中心概念</strong>：你可以想象，有一个服务器，我们所有微服务将自身的信息，IP，端口号等等<br>信息保存在服务器的程序中，当有一个微服务/服务实例(服务或模块内的其中一个实例)想访问另一个微服务<br>时，它会先从保存微服务信息的服务器上获取其他微服务的信息，再发送请求到指定的微服务获取数据。<br>这个服务器上运行的程序，能保存微服务的自身信息，能把数据交给需要请求的微服务，<br>这个程序或者说服务/模块，被称为服务注册中心。</p>
<p>我们微服务将自身数据保存在服务注册中心这个过程叫做<strong>服务注册发现</strong><br>我们微服务拿到其他微服务的信息，向其中一个微服务发送请求这个过程叫做<strong>服务调用</strong>，<br>我们微服务想调用其他服务时，先从服务注册中心获取这个服务的全部实例数据到本地内存中，然后挑选其中<br>一个服务实例，向它发送真实请求，这个挑选一个服务实例的过程被叫做<strong>软件负载均衡</strong>，<br>与硬件负载均衡nginx不同的是，软件负载均衡实现微服务内部调用的负载均衡，而nginx则是内外系统的负载均衡。<br>对于发起请求的微服务，我们叫它<strong>服务消费者</strong>，对于响应请求的微服务，我们叫它<strong>服务提供者</strong>。<br>最后，实现服务注册中心功能有很多种框架或模块，例如：eureka，ZooKeeper，consul，nacos<br>下面将会讲这些框架的使用，因为没正式学过ZooKeeper，只在网课中看老师在linux中使用过，所以没有去了解。<br>另外顺便介绍下ribbon的使用，这是一个实现客户端软件负载均衡的工具。</p>
</li>
</ul>
<blockquote>
<p><span id="f">项目基本介绍</span></p>
</blockquote>
<p>在讲各种服务注册中心框架之前，我先大概介绍一下他们在什么环境下测试的</p>
<ul>
<li><p>项目结构图<br><img src="https://cdn.wanyiai.com/blog/springcloud/%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E5%9B%BE.png" loading="lazy"><br>MyAPI_Commons放着所有模块都需要的代码，都是些实体类<br>MyConsumer_Order80是eureka测试中服务消费者，端口80，表示订单服务<br>MyConsumerXXX_Order80则是使用不同技术作为服务消费者<br>MyEureka_Server7001,7002是eureka服务注册中心<br>MyProvider_Payment8001,8002是eureka测试中服务提供者，表示支付服务<br>MyProviderXXX_Payment则是使用不同技术作为服务提供者</p>
</li>
<li><p>项目POM文件<br>下面是主项目MySpringCloud的pom文件</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>world.keyi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>MySpringCloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
  	<span class="token comment">&lt;!--父模块下所有子模块，父模块打包方式务必是POM方式--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modules</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>MyAPI_Commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>MyEureka_Server7001<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>MyEureka_Server7002<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>MyProvider_Payment8001<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>MyProvider_Payment8002<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>MyConsumer_Order80<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>MyProviderConsul_Payment8006<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>MyConsumerConsul_Order80<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>MyProviderNacos_Payment8840<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>module</span><span class="token punctuation">></span></span>MyConsumerNacos_Order80<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>module</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modules</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">></span></span>

    <span class="token comment">&lt;!--统一jar包和版本号的管理--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>junit.version</span><span class="token punctuation">></span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>junit.version</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log4j.version</span><span class="token punctuation">></span></span>2.13.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>log4j.version</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lombok</span><span class="token punctuation">></span></span>1.16.18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lombok</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mysql.version</span><span class="token punctuation">></span></span>8.0.22<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mysql.version</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>druid.version</span><span class="token punctuation">></span></span>1.1.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>druid.version</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mybatis.spring.boot.version</span><span class="token punctuation">></span></span>2.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mybatis.spring.boot.version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>

    <span class="token comment">&lt;!--
        子模块继承之后，提供作用：锁定版本+子模块(module)不用写groupId和version
        dependencyManagement中的依赖，子模块如果使用了其中的依赖，依赖的版本号都是继承这里
        XXX-dependencies中包含很多个依赖，所有只需要引入其整体就行。
    --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token comment">&lt;!--springCloud依赖--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>Hoxton.SR1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token comment">&lt;!--springCloudAlibaba依赖--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token comment">&lt;!--mysql依赖--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>$&#123;mysql.version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token comment">&lt;!--druid依赖--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>$&#123;druid.version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token comment">&lt;!--mybatis依赖--></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>$&#123;mybatis.spring.boot.version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>$&#123;junit.version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>$&#123;lombok&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.logging.log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>$&#123;log4j.version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginManagement</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginManagement</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.1.3.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fork</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fork</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>addResources</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>addResources</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span>
</code></pre>
</li>
<li><p>SpringBoot，SpringCloud，SpringCloudAlibaba三者之间版本的选择<br><img src="https://cdn.wanyiai.com/blog/springcloud/boot-cloud-alibaba%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.png" loading="lazy"></p>
</li>
<li><p>开发项目流程<br>这个与本篇博客的服务注册中心没关系，主要是想记录一下，下面配置名称都是中文名，<br>因为我使用了idea中文插件，如果你也想配置某个功能，请按照英文名找相应配置项</p>
<ul>
<li><p>选择maven中的<code>maven-archetype-site</code>创建项目<br>(可以选择其他的demo，反正最后src都删掉，只留pom.xml文件)</p>
</li>
<li><p>设置文件编码，打开项目设置，在设置 &gt;  编辑器  &gt;  File Encodings  之中<br>将Global Encoding，Project Encoding，及下面的属性文件的默认编码都改为UTF-8<br>并且将[属性文件的默认编码]旁边打上勾√</p>
</li>
<li><p>开启项目注解，打开项目设置，在设置  &gt;  构建，执行，部署  &gt;  编译器 &gt;  Annotation Processors中<br>将Default和maven default annotation processors profile中的启用注释处理打上勾√</p>
</li>
<li><p>设置项目版本，打开项目设置，在设置  &gt;  构建，执行，部署  &gt;  编译器  &gt;  java编译器中<br>将目标字节码版本改成8，然后打开项目结构，在模块中点击相应的模块，在右边选择语言级别为8</p>
</li>
<li><p>将项目中的<code>*.idea</code>目录或<code>*.iml</code>文件隐藏，打开设置 &gt;  编辑器  &gt;  文件类型(File types)<br>在忽略文件和文件夹输入框中加上：<code>*.idea;*.iml</code>即可，推荐！</p>
</li>
<li><p>以上就是父项目的创建，父项目创建完毕后，就是子项目/模块的创建</p>
<p>大体上就是：创建模块–&gt;改POM文件–&gt;写启动类–&gt;写yaml文件–&gt;写业务类<br>业务类流：建表–&gt;写实体类–&gt;controller–&gt;service–&gt;dao</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p><span id="b">eureka的基本使用</span></p>
</blockquote>
<p>eureka框架是实现服务注册中心的其中一种方式，服务注册中心基于CS架构，分为客户端和服务端，<br>所有微服务都是客户端，eureka作为服务端，下面是eureka注册中心架构图，其他注册中心基本如此：<br><img src="https://cdn.wanyiai.com/blog/springcloud/eureka.png" loading="lazy"></p>
<p>让我们再次捋一捋：服务消费者和服务提供者作为eureka客户端注册到eureka服务中心，当服务消费者发起<br>服务调用时，会被ribbon拦截到请求，ribbon会向eureka注册中心获取服务提供者的服务列表，因为该服务下<br>可能包含多个服务实例，然后使用负载均衡算法选择一个服务实例，向该实例发起请求。</p>
<p><strong>eureka服务端和客户端的配置</strong></p>
<ul>
<li><p>eureka服务端配置</p>
<ul>
<li><p>如上面项目结构图中一样，创建好MyEureka_Server7001子模块，然后引入eureka服务端依赖</p>
<pre class="language-markup" data-language="markup"><code class="language-markup">//该依赖中包含ribbon的依赖
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>eureka服务模块的application.xml</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">7001</span>

<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> eureka7001  <span class="token comment">#eureka服务端的实例名字</span>

  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>    <span class="token comment">#表示不向注册中心注册自己</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>   <span class="token comment">#表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token comment">#设置与eureka server交互的地址查询服务和注册服务都需要依赖这个地址</span>
      <span class="token comment">#就是指定eureka服务注册中心的地址，下面配置的是其他eureka服务端，达到集群效果。</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7002<span class="token punctuation">:</span>7002/eureka/    
  <span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">enable-self-preservation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment">#关闭eureka自我保护模式</span>
<span class="token comment">#    eviction-interval-timer-in-ms: 2000   #eureka内部定时任务调用频率，用于剔除过期的实例</span></code></pre>
</li>
<li><p>eureka服务模块的启动类</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableEurekaServer</span>		<span class="token comment">//开启eureka服务端注解，表示该模块作为eureka服务注册中心</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyEurekaServer7001</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MyEurekaServer7001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
</li>
</ul>
</li>
<li><p>eureka客户端配置<br>我们要模拟订单模块的一个实例向支付模块的一个实例发起请求，首先需要配置订单实例和支付实例<br>两个微服务作为我们的eureka客户端，下面是配置信息</p>
<ul>
<li><p>订单实例，MyConsumer_Order80</p>
<pre class="language-markup" data-language="markup"><code class="language-markup">//eureka客户端依赖
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>

<pre class="language-yaml" data-language="yaml"><code class="language-yaml">//订单实例的application.yaml
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> MyConsumerOrder80

<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment">#是否注册进服务注册中心</span>
    <span class="token comment"># 是否从服务注册中心抓取已有的注册信息，默认为true，单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡</span>
    <span class="token key atrule">fetchRegistry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>   
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>  <span class="token comment"># 服务注册中心的地址</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7001/eureka  <span class="token comment"># 单机版</span>
<span class="token comment">#      defaultZone: http://eureka7001:7001/eureka,http://eureka7002:7002/eureka  # 集群版</span></code></pre>

<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//MyConsumer_Order80启动类</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableEurekaClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyConsumerOrder80</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MyConsumerOrder80</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
</li>
<li><p>支付实例，MyProvider_Payment8001<br>eureka客户端依赖同上</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml">//MyProvider_Payment8001的application.xml
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8001</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> MyProviderPayment

  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/mycloud<span class="token punctuation">?</span>serverTimezone=GMT<span class="token important">&amp;useSSL=false&amp;characterEncoding=utf-</span><span class="token number">8</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123765</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">*.xml</span>
<span class="token comment">#  type-aliases-package: world.keyi.entities   # 所有Entity别名类所在包，别名在MyAPI_Commons模块中</span>


<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment">#是否注册进服务注册中心</span>
    <span class="token comment"># 是否从服务注册中心抓取已有的注册信息，默认为true，单节点无所谓，集群必须设置为true才能配合ribbon使用负载均衡</span>
    <span class="token key atrule">fetchRegistry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>   
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>  <span class="token comment"># 服务注册中心的地址</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7001/eureka  <span class="token comment"># 单机版</span>
<span class="token comment">#      defaultZone: http://eureka7001:7001/eureka,http://eureka7002:7002/eureka  # 集群版</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> payment8001  <span class="token comment">#配置主机名，在eureka界面上status下就会显示该名称，而不是主机名称+服务名称+端口号</span>
    <span class="token comment">#在eureka界面上，鼠标放到status下的链接上，左下角可以显示该服务的ip地址端口号等信息，表示点击后会跳转的地址</span>
    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>   
<span class="token comment">#    lease-renewal-interval-in-seconds: 1    #每次间隔多长时间发送心跳，默认30秒</span>
     <span class="token comment">#过了多长时间内不发送心跳，如果没有开启eureka保护模式，则会被剔除，默认90秒</span>
<span class="token comment">#    lease-expiration-duration-in-seconds: 2   </span></code></pre>

<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//MyProvider_Payment8001的启动类</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableEurekaClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyProviderPayment8001</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MyProviderPayment8001</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

</li>
</ul>
</li>
</ul>
<p>本次实验eureka服务端和客户端的配置已经完成，当我们启动eureka服务模块后，再启动订单模块和支付模块后<br>输入eureka的网址：<code>http://localhost:7001</code>，我们就可以发现，订单服务和支付服务都注册到了eureka中了</p>
<p>让我们来看看订单服务如何调用支付服务呢？<br>在没学习服务调用框架之前，我们可以使用restTemplate库来调用其他微服务，下面是restTemplate的配置<br>以及订单服务的controller，支付服务的controller</p>
<ul>
<li><p>restTemplate的配置，当然是配置在订单模块中，因为是它发起请求嘛</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationContextConfig</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
</li>
<li><p>订单模块的controller</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/order"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> PAYMENT_URL<span class="token operator">=</span><span class="token string">"http://localhost:8001/payment/eureka/"</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/&#123;id&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">getPayment</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"正在获取订单数据"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span>  restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>PAYMENT_URL<span class="token operator">+</span>id<span class="token punctuation">,</span><span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Payment</span> payment<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"正在存入订单数据"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">postForObject</span><span class="token punctuation">(</span>PAYMENT_URL<span class="token punctuation">,</span>payment<span class="token punctuation">,</span><span class="token class-name">CommonResult</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
</li>
<li><p>支付模块的controller</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">world<span class="token punctuation">.</span>keyi<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/payment/eureka"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PaymentController</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;server.port&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> port<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">PaymentService</span> paymentService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/&#123;id&#125;"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Payment</span><span class="token punctuation">></span></span> <span class="token function">queryById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">Payment</span> payment <span class="token operator">=</span> paymentService<span class="token punctuation">.</span><span class="token function">queryById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"查询结果是："</span><span class="token operator">+</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>payment<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">"查询成功，访问的port:"</span><span class="token operator">+</span>port<span class="token punctuation">,</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span><span class="token string">"查询失败"</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Payment</span> payment<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> result <span class="token operator">=</span> paymentService<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>payment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"插入结果是："</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">"插入成功，访问的port:"</span><span class="token operator">+</span>port<span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token string">"插入失败"</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

</li>
</ul>
<p>以上是最普通不过的服务之间的调用，虽然我们可以在eureka网址上查看的到订单模块和支付模块的信息，<br>表明这两个模块已经注册到了eureka服务端上，但是上面的调用，完全没有使用到eureka提供的信息，<br>并且，因为请求路径写死，表明订单模块只能访问到支付模块的固定一个支付实例，完全没有高可用，也没有所谓的负载均衡<br>那么，订单模块如何获取eureka上的支付模块数据呢？当支付模块下有多个支付实例时，又是如何实现负载均衡的呢？配置步骤如下：</p>
<ul>
<li><p>将订单模块的请求地址改成支付模块的服务名称</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> PAYMENT_URL<span class="token operator">=</span><span class="token string">"http://MYPROVIDERPAYMENT/payment/eureka/"</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>在restTemplate的Bean上添加@LoadBalanced注解</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationContextConfig</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token comment">//使得请求可以被负载均衡，配置后请求的接口应该是服务端的项目名称，例如：MyProviderPayment，这就是Ribbon的负载均衡的功能</span>
    <span class="token annotation punctuation">@LoadBalanced</span>   
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

</li>
</ul>
<p>OK，通过配置我们就可以实现，订单模块调用支付模块的数据了，你可能好奇，为什么请求地址要写成支付模块<br>的服务名称，这里的服务名称就是支付模块中配置的<code>spring.application.name</code>，底层是如何解析这个服务名称<br>负载均衡又是如何实现的呢？别急，在ribbon中我们会讲到。</p>
<p>上面实现的是单个订单实例访问单个支付实例，没有负载均衡的效果，因为只有一台实例嘛，并且eureka也不是<br>集群的配置，只有一台eureka服务，那么如何配置多个eureka，达到集群的效果的？<br>实际上我们只需要在eureka的application.yaml上配置其他eureka服务地址即可，所有eureka实例互相配置其他<br>eureka实例的地址，而客户端则配置所有的eureka服务实例</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml">//MyEureka_Server7001，eureka服务端
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">7001</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> eureka7001  <span class="token comment">#eureka服务端的实例名字</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>    <span class="token comment">#表示不向注册中心注册自己</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>   <span class="token comment">#表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7002<span class="token punctuation">:</span>7002/eureka/ <span class="token comment">#配置eureka集群中其他的地址</span>

//MyEureka_Server7002，eureka服务端
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">7002</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> eureka7002  <span class="token comment">#eureka服务端的实例名字</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>    <span class="token comment">#表示不向注册中心注册自己</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>   <span class="token comment">#表示自己就是注册中心，职责是维护服务实例，并不需要去检索服务</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001<span class="token punctuation">:</span>7001/eureka/ <span class="token comment">#同上</span>

//订单服务
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> MyConsumerOrder80		<span class="token comment">#服务名称，服务名称可以相同，表示一个服务名称下有多个服务实例</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment">#是否注册进服务注册中心</span>
    <span class="token key atrule">fetchRegistry</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>   
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>  <span class="token comment"># 服务注册中心的地址</span>
<span class="token comment">#      defaultZone: http://localhost:7001/eureka  # 单机版</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//eureka7001<span class="token punctuation">:</span>7001/eureka<span class="token punctuation">,</span>http<span class="token punctuation">:</span>//eureka7002<span class="token punctuation">:</span>7002/eureka  <span class="token comment"># 集群版</span>

//支付模块同样如此配置，只需要配置eureka.client.service<span class="token punctuation">-</span>url.defaultZone即可</code></pre>

<p>讲完eureka服务端和客户端的配置，讲完如何配置使得可以通过服务名称达到请求支付实例，<br>并且还具有负载均衡的效果，讲完如何配置eureka集群，接下来我们讲讲eureka的保护机制</p>
<p>eureka有一个保护机制，即当微服务注册到eureka上后，每30秒发送一次心跳给eureka服务注册中心，<br>如果90秒后，eureka发现微服务还没有发送心跳，eureka本来是要剔除该微服务的，但是如果eureka在短时间内<br>发现过多的微服务超过90秒没有发送心跳，就会认为当前网络不是很好，便会开启保护模式，不会剔除这些微服务<br>eureka的保护机制是默认开启的，那么如何关闭保护机制呢？通过修改eureka的application.yaml中的<br><code>eureka.server.enable-self-preservation=false</code>来关闭保护机制<br>eureka的保护机制强调的是可用性，即当网络不好的时候，首先保证用户的可用性，即属于CAP理论中的AP分支<br>CAP即数据一致性，数据可用性和数据容错分区，分为AP和CP分支，下面是一张CAP阵营的图片<br><img src="https://cdn.wanyiai.com/blog/springcloud/CAP%E7%90%86%E8%AE%BA.png" loading="lazy"></p>
<p>以上就是关于eureka的介绍及基本使用</p>
<blockquote>
<p><span id="c">ribbon的基本使用</span></p>
</blockquote>
<p>还记得刚刚上面说的嘛？为什么我们订单模块中使用服务名称就可以请求到支付模块呢？<br>为什么加上@LoadBalanced注解，就可以实现请求负载均衡？全部都是ribbon的功劳<br>当我们发出请求后，ribbon会拦截我们的请求，拿到服务名称，根据服务名称获取eureka注册中心上相应的服务<br>这个服务可能有多个服务实例，ribbon会根据不同的负载均衡算法去选择一个服务实例，拿到该服务实例的URI<br>再去请求这个地址，这就是ribbon在请求时的作用。这里来一张ribbon的执行流程图片<br><img src="https://cdn.wanyiai.com/blog/springcloud/Ribbon%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png" loading="lazy"><br>下面是对上图的解释：</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token number">1</span><span class="token punctuation">)</span>拦截我们的<span class="token class-name">RestTemplate</span>请求http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>userservice<span class="token operator">/</span>user<span class="token operator">/</span><span class="token number">1</span>
<span class="token number">2</span><span class="token punctuation">)</span><span class="token class-name">RibbonLoadBalancerClient</span>会从请求url中获取服务名称，也就是user<span class="token operator">-</span>service
<span class="token number">3</span><span class="token punctuation">)</span><span class="token class-name">DynamicServerListLoadBalancer</span>根据user<span class="token operator">-</span>service到eureka拉取服务列表
<span class="token number">4</span><span class="token punctuation">)</span>eureka返回列表，localhost<span class="token operator">:</span><span class="token number">8081</span>、localhost<span class="token operator">:</span><span class="token number">8082</span>
<span class="token number">5</span><span class="token punctuation">)</span><span class="token class-name">IRule</span>利用内置负载均衡规则，从列表中选择一个，例如localhost<span class="token operator">:</span><span class="token number">8081</span>
<span class="token number">6</span><span class="token punctuation">)</span><span class="token class-name">RibbonLoadBalancerClient</span>修改请求地址，用localhost<span class="token operator">:</span><span class="token number">8081</span>替代userservice，得到http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">8081</span><span class="token operator">/</span>user<span class="token operator">/</span><span class="token number">1</span>，发起真实请求</code></pre>

<p>其实呢，我们自己也可以根据服务名称，获取到该服务名称下所有的服务实例，这叫做服务发现，步骤如下：</p>
<ul>
<li><p> 程序主入口中加上@EnableDiscoveryClient注解</p>
</li>
<li><p>自动注入DiscoveryClient接口</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Resource</span>
<span class="token keyword">private</span> <span class="token class-name">DiscoveryClient</span> discoveryClient<span class="token punctuation">;</span></code></pre>
</li>
<li><p>使用DiscoveryClient可以获取eureka上所有的服务名称，或者根据服务名称，拿到注册中心的所有服务实例</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"discovery"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getDiscovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token comment">/*查看eureka上注册的所有服务名称*/</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> services <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> service <span class="token operator">:</span> services<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">/*根据服务名称，查看该服务名称下的所有服务实例*/</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">></span></span> instances <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getInstances</span><span class="token punctuation">(</span><span class="token string">"MYPROVIDERPAYMENT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ServiceInstance</span> instance <span class="token operator">:</span> instances<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token function">getServiceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"---"</span><span class="token operator">+</span>instance<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"---"</span><span class="token operator">+</span>instance<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"---"</span><span class="token operator">+</span>instance<span class="token punctuation">.</span><span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

</li>
</ul>
<p>我们知道，一旦开启了@LoadBalanced注解就能实现请求负载均衡，默认情况下，ribbon负载均衡算法是轮询模式<br>来看看ribbon中有多少种负载均衡算法吧<br><img src="https://cdn.wanyiai.com/blog/springcloud/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95.png" loading="lazy">那么怎么更改默认的负载均衡算法呢？更改默认的负载均衡算法有两种方式：</p>
<ul>
<li><p>全局生效，即更改后，不管是向那个服务名称发送请求，都是使用该模式</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//直接在配置类上增加Bean</span>
<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">IRule</span> <span class="token function">rule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RandomRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>
</li>
<li><p>局部生效，向指定的服务名称发送请求使用更改的负载均衡算法，向其他服务名称还是使用轮询算法</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//在模块的application.yaml中配置</span>
<span class="token class-name">MyProviderNacosPayment</span><span class="token operator">:</span> #指定某个服务名称，实现更改单个请求该服务时选择指定的负载均衡规则
  ribbon<span class="token operator">:</span>
    <span class="token class-name">NFLoadBalancerRuleClassName</span><span class="token operator">:</span> com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>loadbalancer<span class="token punctuation">.</span><span class="token class-name">RandomRule</span>    #随机算法</code></pre>

</li>
</ul>
<p>通过上面的配置，我们的默认负载均衡算法就可以更改了，那么，可不可以定义自己的负载均衡算法呢？<br>当然也是可以的，下面我们来实现一下ribbon的默认负载均衡算法，轮询算法</p>
<ul>
<li><p>首先创建一个LoadBalancer接口，并创建该接口的实现类</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//LoadBalancer接口，该接口用于根据实现类的不同实现，找到合适的服务实例</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">LoadBalancer</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">ServiceInstance</span> <span class="token function">selectInstance</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">></span></span> instances<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//如果想实现轮询算法，则实现上面的接口，重写该方法即可，下面是MyLoadBalancer，重写轮询算法</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyLoadBalancer</span> <span class="token keyword">implements</span> <span class="token class-name">LoadBalancer</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/*
        自定义负载均衡算法，实现轮询算法，轮询算法根据:rest请求次数%可用服务集合总数等于index下标
        根据该index下标，从而获取可用服务集合中某个微服务。

        该算法要做两件事，一是rest请求次数需要在多线程的环境下每次都自增，二是通过取余拿到下标值，返回指定的服务实例
        主要问题是rest请求需要在多线程环境下保持自增，我们通过CAS+自旋锁的方式使得rest请求数自增+1
        当然使用AtomicInteger.getAndIncrement()就行，我们这是相当于实现这个方法。
     */</span>

    <span class="token class-name">AtomicInteger</span> atomicInteger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> current<span class="token punctuation">,</span>next<span class="token punctuation">;</span>
        <span class="token keyword">do</span><span class="token punctuation">&#123;</span>     <span class="token comment">//通过do-while不断自旋</span>
            current <span class="token operator">=</span> atomicInteger<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//根据内存地址拿到主内存中共同的值到本地内存中</span>
            next <span class="token operator">=</span> current <span class="token operator">>=</span><span class="token number">2147483647</span> <span class="token operator">?</span> <span class="token number">0</span><span class="token operator">:</span> current<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>atomicInteger<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span>next<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">//如果current值不变，则将current对应的地址中的值改成next，有乐观锁感觉了</span>
        <span class="token keyword">return</span> next<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ServiceInstance</span> <span class="token function">selectInstance</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">></span></span> instances<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> instances<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span>instances<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>
</li>
<li><p>在controller中使用我们自定义的负载均衡算法吧</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Resource</span>
<span class="token class-name">MyLoadBalancer</span> myLoadBalancer<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Resource</span>
<span class="token class-name">DiscoveryClient</span> discoveryClient<span class="token punctuation">;</span>

<span class="token comment">/*
    测试自定义负载均衡算法
*/</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/lb"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">myLoadBalancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"正在使用自己的负载均衡算法"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//获取该服务名称下所有的服务实例</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">></span></span> myproviderpayment <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getInstances</span><span class="token punctuation">(</span><span class="token string">"MYPROVIDERPAYMENT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>myproviderpayment<span class="token operator">==</span><span class="token keyword">null</span><span class="token operator">||</span>myproviderpayment<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">//根据自定义负载均衡算法找到合适的服务实例</span>
  <span class="token class-name">ServiceInstance</span> serviceInstance <span class="token operator">=</span> myLoadBalancer<span class="token punctuation">.</span><span class="token function">selectInstance</span><span class="token punctuation">(</span>myproviderpayment<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">URI</span> uri <span class="token operator">=</span> serviceInstance<span class="token punctuation">.</span><span class="token function">getUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//拿到服务实例信息，获取URI发送请求</span>
  <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>uri<span class="token operator">+</span><span class="token string">"/payment/eureka/lb"</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

</li>
</ul>
<p>OK，最后我们了解一下ribbon的饥饿加载<br>Ribbon默认是采用懒加载，即第一次访问时才会去创建LoadBalancedClient，请求时间会很长<br>而饥饿加载则会在项目启动时创建，降低第一次访问的耗时，通过下面配置开启饥饿加载</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">ribbon</span><span class="token punctuation">:</span> 
  <span class="token key atrule">eager-load</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>	<span class="token comment">#开启饥饿加载</span>
    <span class="token key atrule">clients</span><span class="token punctuation">:</span> MYPROVIDERPAYMENT <span class="token comment">#指定对该服务饥饿加载</span></code></pre>

<p>以上是ribbon的全部介绍和使用</p>
<blockquote>
<p><span id="d">consul的基本使用</span></p>
</blockquote>
<p>consul和eureka一样，也可以作为服务注册中心，我们可以去它官网下载consul应用，运行起来后consul服务端就开启了<br>接下来我们只需要在我们的微服务中配置consul客户端就行，下面是配置步骤</p>
<ul>
<li><p>导入consul依赖</p>
<pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>在入口类中加上@EnableDiscoveryClient注解用于consul找到consul客户端服务</p>
<p>@EnableDiscoveryClient和@EnableEurekaClient异同：</p>
<ul>
<li>共同点就是：都是能够让注册中心能够发现，扫描到该服务。</li>
<li>不同点：@EnableEurekaClient只适用于Eureka作为注册中心，@EnableDiscoveryClient可以是其他注册中心。</li>
</ul>
</li>
<li><p>在模块的application.yaml中增加consul的配置</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8006</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> MyProviderConsulPayment   <span class="token comment"># 本模块，服务的名称</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token comment"># 注册中心的配置</span>
    <span class="token key atrule">consul</span><span class="token punctuation">:</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8500</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">service-name</span><span class="token punctuation">:</span> $<span class="token punctuation">&#123;</span>spring.application.name<span class="token punctuation">&#125;</span>    <span class="token comment"># 向外暴露本服务，即注册到consul中</span></code></pre>

</li>
</ul>
<p>与eureka不同的是：consul，ZooKeeper都属于CAP中的CP分支，而eureka服务注册中心则是AP分支<br>CP分支强调数据的一致性，一旦发现微服务心跳不正常，立马将该服务信息剔除出注册中心。</p>
<blockquote>
<p><span id="e">nacos中关于注册中心的使用</span></p>
</blockquote>
<p>nacos是SpringCloudAlibaba中的组件，既能做服务注册中心，也能做服务配置中心，关于服务配置中心，<br>我会在之后的博客中有更细节的介绍使用，这里主要讲讲nacos作为注册中心的使用，下面是nacos关于注册中心的内容</p>
<ul>
<li><p>nacos客户端的配置<br>和consul一样，在官网下好nacos运行后，就启动了nacos服务端，端口号是8848，钛金手机~<br>下面是客户端的配置，直接三板斧：加依赖，加注解，加配置</p>
<ul>
<li><p>导入nacos依赖</p>
<pre class="language-markup" data-language="markup"><code class="language-markup">//父工程中引入
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2.6.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
//子模块中引入
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></code></pre>
</li>
<li><p>增加@EnableDiscoveryClient注解在入口类上</p>
</li>
<li><p>增加nacos配置</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8840</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> MyProviderNacosPayment	<span class="token comment">#本模块的服务名称</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>   <span class="token comment">#nacos注册中心地址</span></code></pre>

<p>配置完成后，访问nacos的地址就可以看到注册中心上已经有模块的信息了</p>
</li>
</ul>
</li>
<li><p>nacos服务分级存储模型<br>一个服务可能有多个服务实例，这些实例并不一定是在同一个地方，可能有的被部署在上海<br>有的服务实例部署在杭州，北京等等，部署在上海的就是上海机房，部署某地一般就叫某地机房<br>nacos将同一个地方的所有实例划分为一个集群，例如上海集群有2个订单实例，2个支付实例<br>杭州集群有3个订单实例，2个支付实例，当某个微服务访问的时候，首先会访问本集群中的实例，如果<br>本集群中没有这个实例，就会跨集群访问，这种容灾备份的方式非常不错，下面是这种服务分级存储模型<br><img src="https://cdn.wanyiai.com/blog/springcloud/%E6%9C%8D%E5%8A%A1%E5%88%86%E7%BA%A7%E5%AD%98%E5%82%A81.png" loading="lazy"></p>
<p>要实现集群的效果，我们需要加上相应的配置：<code>spring.cloud.nacos.discovery.cluster-name=XXX</code>，表示该实例属于XXX集群<br>配置好集群后，通过请求，我们发现还是没有达到我们想要的效果：当本集群没有想要的服务实例时才去访问其他集群的实例<br>本集群有就只访问本集群中的服务实例。要达到本集群优先的负载均衡，我们需要增加一些配置：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">userservice</span><span class="token punctuation">:</span>	<span class="token comment">#指定某个服务名称，访问该服务时，先访问本地集群的服务实例</span>
  <span class="token key atrule">ribbon</span><span class="token punctuation">:</span>
    <span class="token key atrule">NFLoadBalancerRuleClassName</span><span class="token punctuation">:</span> com.alibaba.cloud.nacos.ribbon.NacosRule <span class="token comment"># 负载均衡规则 </span></code></pre>
</li>
<li><p>nacos权重配置<br>现实生活中，一定有这种情况：有些服务器性能好，我想让他处理更多请求，有些服务器性能差我想让他<br>少处理点请求，这种情况下，nacos的权重就非常有用了，服务实例的权重在nacos的服务注册中可以更改<br>不需要更改我们的代码，默认情况下，所有服务实例的权重都是1，即同集群下随机挑选实例。</p>
</li>
<li><p>nacos的环境隔离<br>环境隔离指的是将服务实例区分开来，例如开发环境，测试环境，生产环境等，不同的环境的实例不能相互访问<br>在地点上，我们可以把服务实例分为不同的集群，在项目上，我们把服务实例分为不同的环境<br>那么如何配置服务实例的环境呢？我们的nacos客户端默认的是public环境，如果想更改成其他环境，<br>首先需要在nacos网站上增加一个namespace命名空间，会生成一个命名空间ID，复制这个ID，<br>然后在我们的服务实例上配置命令空间，如下：</p>
<pre class="language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">cluster-name</span><span class="token punctuation">:</span> HZ
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 492a7d5d<span class="token punctuation">-</span>237b<span class="token punctuation">-</span>46a1<span class="token punctuation">-</span>a99a<span class="token punctuation">-</span>fa8e98e4b0f9 <span class="token comment"># 命名空间，填ID</span></code></pre>

<p>配置好后，启动该服务实例，就可以看到该服务出现在新建的命名空间之下了。</p>
</li>
</ul>
<p>以上就是学习服务注册中心的全部内容，今后碰到新的内容，还会不断的更新，加油加油！</p>
</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><span class="icon iconify" data-icon="ri:hand-coin-line"></span></span><div id="reward-comment">一分也是爱~~</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.wanyiai.com/blog/pay/alipay.jpg"><img loading="lazy" src="https://cdn.wanyiai.com/blog/pay/alipay.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.wanyiai.com/blog/pay/wechatpay.jpg"><img loading="lazy" src="https://cdn.wanyiai.com/blog/pay/wechatpay.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>NicknamedCoco</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://wanyiai.com/2021/10/22/SpringCloud%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" title="SpringCloud学习之服务注册中心">https://wanyiai.com/2021/10/22/SpringCloud%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2021/10/28/SpringCloud%E5%AD%A6%E4%B9%A0%E4%B9%8BOpenFeign,Hystrix,Gateway%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" rel="prev" title="SpringCloud学习之OpenFeign,Hystrix,Gateway的基本使用"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">SpringCloud学习之OpenFeign,Hystrix,Gateway的基本使用</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2021/10/10/Vue%E5%AE%8C%E7%BB%93%E7%AF%87/" rel="next" title="Vue完结篇"><span class="post-nav-text">Vue完结篇</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>欢迎留下你的脚印~</span><br></div><div id="waline"></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@waline/client@v2/dist/waline.css"><script>window.CONFIG.waline.config.path = "/2021/10/22/SpringCloud%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/"</script><div class="js-Pjax"><script src="/js/comments/waline.js" type="module" defer></script></div></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">赣ICP备2022005395号</a></div><div class="copyright"><span>&copy; 2019 – 2022 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> NicknamedCoco</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v6.2.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.2</span></div><div class="live-time"><span>本博客已萌萌哒地运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2020-09-22T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = ` ${passDay} 天 ${passHour} 小时 ${passMinute} 分 ${passSecond} 秒`;
}
blog_live_time();
</script></div><div class="footer-support"><span>本网站由</span><a class="footer-support-logo" href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral" target="blank" title="又拍云"><img height="30" src="https://cdn.yunyoujun.cn/img/logo/upyun-logo.png" alt="又拍云"></a><span>提供 CDN 加速/云存储服务</span></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:search-line"></span></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="https://fastly.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js"></script><script src="/js/search/local-search.js" defer type="module"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><span class="icon iconify" data-icon="ri:close-line"></span></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div class="search-result-container"></div></div></body></html>